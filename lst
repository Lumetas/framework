<?php

require __DIR__ . '/vendor/autoload.php';
require_once __DIR__ . '/lum/core/RecursiveLoad.php';

// Подключаем файлы core
requireFilesRecursively(__DIR__ . '/lum/core');

use Lum\Core\Database;
$config = require "config.php";
try {
	$database = Database::getInstance($config['database']);
	$pdo = $database->getPdo();
} catch (Exception $e) {
	throw new Exception("Проблема с базой данных, проверь config.php");
}



// Проверяем, что скрипт запущен из командной строки
if (php_sapi_name() !== 'cli') {
	die('This script can only be run from the command line.');
}
define("PROJECT_DIR", __DIR__);
// Проверяем, передан ли аргумент
if ($argc < 2) {
	die("Usage: php console.php <command>\n");
}

// Получаем имя команды (первый аргумент)
$commandName = $argv[1];

// Путь к файлу команды
$commandFile = __DIR__ . "/lum/commands/{$commandName}.php";

// Проверяем, существует ли файл команды
if (!file_exists($commandFile)) {
	die("Error: Command '$commandName' not found.\n");
}

// Подключаем файл команды
$command = require $commandFile;
array_splice($argv, 0, 2);
$argc -= 2;
// Запускаем команду (предполагаем, что в файле команды есть функция run())
try {
	$command->run($argv, $argc);
} catch (Exception $e) {
	echo $e->getMessage()."\n";
	exit();
}
